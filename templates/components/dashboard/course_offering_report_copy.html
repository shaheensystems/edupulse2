<!-- course_offering_report_copy.html -->
<div class="course-offering-report">
  <div class="flex flex-col w-1/3 p-4 border-r-2 border-gray-200">
    <a href="{% url 'course_offering_detail' co.pk %}" class='flex text-left underline underline-offset-4 text-blue-500 mb-3'>{{ co.temp_id|upper }}</a>
    <div class="flex flex-col">
      <div class="flex flex-row justify-between items-center">
        <form id="filter-form-{{ co.pk }}" class="filter-form" data-co-id="{{ co.pk }}">
          <select id="filter-select-{{ co.pk }}" name="attendances__session_no" class="filter-select">
            <option value="">Select Session</option>
            <option value="{{ 1 }}">session_1</option>
            <option value="{{ 2 }}">session_2</option>
            {% comment %} {% for value, label in form.fields.attendances__session_no.choices %}
              <option value="{{ value }}">{{ label }}</option>
            {% endfor %} {% endcomment %}
          </select>
        </form>
        <div class="flex bg-gray-100 shadow-md px-4 py-1 items-center text-sm text-blue-400">Edit</div>
      </div>
      <div class="mb-4 w-2/3 flex items-center content-center self-center">
        {% with data=co.calculate_student_attendance_chart_data title='' id=co.id chartType='doughnut' lengendDisplay='false' limitData=10 %}
          {% include 'charts/chart.html' %}
        {% endwith %}
      </div>
    </div>
    <div class="flex flex-row justify-between">
      <div>
        <div class="flex items-center">
          <div class="h-2 w-2 rounded-full bg-blue-500 mr-2"></div>
          <p>Present</p>
        </div>
        <p>{{ co.calculate_student_attendance_percentage.present_percentage }}</p>
      </div>
      <div>
        <div class="flex items-center">
          <div class="h-2 w-2 rounded-full bg-green-500 mr-2"></div>
          <p>Informed Absent</p>
        </div>
        <p>{{ co.calculate_student_attendance_percentage.informed_absent_percentage }}</p>
      </div>
      <div>
        <div class="flex items-center">
          <div class="h-2 w-2 rounded-full bg-red-500 mr-2"></div>
          <p>Absent</p>
        </div>
        <p>{{ co.calculate_student_attendance_percentage.absent_percentage }}</p>
      </div>
    </div>
  </div>
  <!-- Add a results container -->
  <div id="filtered-results-{{ co.pk }}"></div>
  <!-- Additional sections as needed -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
$(document).ready(function() {
  $('.filter-select').change(function() {
    var form = $(this).closest('.filter-form');
    var courseOfferingId = form.data('co-id');
    console.log('Course Offering ID:', courseOfferingId);
    $.ajax({
      url: '{% url "filter_attendances" 0 %}'.replace('0', courseOfferingId),
      data: form.serialize(),
      success: function(data) {
        var resultsDiv = $('#filtered-results-' + courseOfferingId);
        resultsDiv.empty();
        data.filtered_attendances.forEach(function(attendance) {
          resultsDiv.append('<p>Week ' + attendance.week_no + ': Session ' + attendance.session_no + ' - ' + attendance.attendance_date + '</p>');
        });
      }
    });
  });
});
</script>

</div>
